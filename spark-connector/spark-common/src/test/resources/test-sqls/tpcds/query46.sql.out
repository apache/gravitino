-- Automatically generated by Gravitino Spark SQL test
-- !query
select  c_last_name
       ,c_first_name
       ,ca_city
       ,bought_city
       ,ss_ticket_number
       ,amt,profit 
 from
   (select ss_ticket_number
          ,ss_customer_sk
          ,ca_city bought_city
          ,sum(ss_coupon_amt) amt
          ,sum(ss_net_profit) profit
    from store_sales,date_dim,store,household_demographics,customer_address 
    where store_sales.ss_sold_date_sk = date_dim.d_date_sk
    and store_sales.ss_store_sk = store.s_store_sk  
    and store_sales.ss_hdemo_sk = household_demographics.hd_demo_sk
    and store_sales.ss_addr_sk = customer_address.ca_address_sk
    and (household_demographics.hd_dep_count = 5 or
         household_demographics.hd_vehicle_count= 3)
    and date_dim.d_dow in (6,0)
    and date_dim.d_year in (1999,1999+1,1999+2) 
    and store.s_city in ('Midway','Fairview','Fairview','Fairview','Fairview') 
    group by ss_ticket_number,ss_customer_sk,ss_addr_sk,ca_city) dn,customer,customer_address current_addr
    where ss_customer_sk = c_customer_sk
      and customer.c_current_addr_sk = current_addr.ca_address_sk
      and current_addr.ca_city <> bought_city
  order by c_last_name
          ,c_first_name
          ,ca_city
          ,bought_city
          ,ss_ticket_number
  limit 100
-- !query schema
struct<c_last_name:string,c_first_name:string,ca_city:string,bought_city:string,ss_ticket_number:bigint,amt:decimal(17,2),profit:decimal(17,2)>
-- !query output
Dawkins	Steven	Sulphur Springs	Lakeside	1081	170.54	-3082.05
Foster	Crystal	Mount Pleasant	Tipton	995	2601.52	-7543.44
Francis	Charles	Saint James	Kingston	654	5466.98	-10040.21
Jackson	Wendell	Leesville	Buena Vista	2371	0.00	-10864.09
Martin	Rosalyn	New Hope	Bethel	1690	1601.21	-6212.86
NULL	Debbie	New Hope	Woodlawn	214	1262.89	-6315.68
Nolan	Carrie	Riverdale	Hamilton	547	237.31	-11848.56
Smith	William	Mechanicsburg	Delta	104	77.21	-3292.57
Willis	Robert	Ashland	Clifton	1702	2675.87	-8570.98
Wyatt	Alexander	Mountain View	Crossroads	176	2720.05	-23501.88
