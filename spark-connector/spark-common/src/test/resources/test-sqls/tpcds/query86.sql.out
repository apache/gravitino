-- Automatically generated by Gravitino Spark SQL test
-- !query
select   
    sum(ws_net_paid) as total_sum
   ,i_category
   ,i_class
   ,grouping(i_category)+grouping(i_class) as lochierarchy
   ,rank() over (
 	partition by grouping(i_category)+grouping(i_class),
 	case when grouping(i_class) = 0 then i_category end 
 	order by sum(ws_net_paid) desc) as rank_within_parent
 from
    web_sales
   ,date_dim       d1
   ,item
 where
    d1.d_month_seq between 1212 and 1212+11
 and d1.d_date_sk = ws_sold_date_sk
 and i_item_sk  = ws_item_sk
 group by rollup(i_category,i_class)
 order by
   lochierarchy desc,
   case when lochierarchy = 0 then i_category end,
   rank_within_parent
 limit 100
-- !query schema
struct<total_sum:decimal(17,2),i_category:string,i_class:string,lochierarchy:tinyint,rank_within_parent:int>
-- !query output
102290.70	Shoes	womens	0	1
10787.43	Electronics	audio	0	16
1093.49	NULL	archery	0	2
11022.02	Books	entertainments	0	13
111286.37	Children	newborn	0	1
118049.61	Music	classical	0	2
12126.97	Electronics	camcorders	0	15
12154.20	Jewelry	mens watch	0	9
124172.19	Music	pop	0	1
12745.95	Books	sports	0	12
12884.37	Home	wallpaper	0	15
12934.66	Electronics	disk drives	0	14
13463.79	Home	accent	0	14
14039.26	Home	bathroom	0	13
15200.01	Home	lighting	0	12
15806.26	Home	mattresses	0	11
15959.04	Home	blinds/shades	0	10
16181.72	Electronics	musical	0	13
16603.51	Electronics	televisions	0	12
17450.28	Home	furniture	0	9
17899.49	Electronics	automotive	0	11
17936.83	Electronics	personal	0	10
19425.12	Jewelry	earings	0	8
19935.09	Electronics	cameras	0	9
20141.05	Electronics	monitors	0	8
20486.58	Books	arts	0	11
20966.37	Jewelry	custom	0	7
21405.38	Electronics	scanners	0	7
21585.50	Books	self-help	0	10
22420.83	Home	rugs	0	8
23237.85	Home	glassware	0	7
23351.19	Electronics	stereo	0	6
23685.42	Electronics	portable	0	5
24077.16	Home	flatware	0	6
24098.24	Home	curtains/drapes	0	5
24267.98	Jewelry	jewelry boxes	0	6
25280.73	Books	travel	0	9
25396.40	Sports	hockey	0	6
25497.26	Books	romance	0	8
25628.99	Sports	pools	0	5
25685.78	Books	mystery	0	7
26188.92	Home	kids	0	4
26207.48	Home	bedding	0	3
264069.51	Men	NULL	1	10
27714.14	Home	tables	0	2
27721.64	Sports	fishing	0	4
28253.95	Electronics	wireless	0	4
292100.08	Jewelry	NULL	1	9
29421.88	Jewelry	diamonds	0	5
29610.89	Books	fiction	0	6
3048.08	NULL	NULL	0	1
323095.87	Home	NULL	1	8
326654.63	Sports	NULL	1	7
326706.72	Children	NULL	1	6
33242.75	Books	computers	0	5
33743.30	Men	pants	0	4
33766.58	Jewelry	costume	0	4
34202.48	Electronics	karoke	0	3
3430589.35	NULL	NULL	2	1
34716.50	Sports	golf	0	3
355954.25	Electronics	NULL	1	5
36058.16	Jewelry	estate	0	3
36868.14	Jewelry	bracelets	0	2
372484.83	Shoes	NULL	1	4
37660.32	Sports	tennis	0	2
37924.12	Books	science	0	4
384412.75	Women	NULL	1	3
388761.90	Music	NULL	1	2
38931.89	Home	decor	0	1
39030.69	Electronics	memory	0	2
392207.24	Books	NULL	1	1
39457.02	Jewelry	gold	0	1
4141.57	NULL	NULL	1	11
41478.39	Electronics	dvd/vcr players	0	1
41905.95	Books	cooking	0	3
41954.69	Books	reference	0	2
4218.22	Jewelry	womens watch	0	16
42849.73	Books	history	0	1
43832.72	Sports	outdoor	0	1
4418.98	Jewelry	loose stones	0	15
4532.94	Jewelry	consignment	0	14
4705.01	Jewelry	pendants	0	13
47762.25	Music	rock	0	4
4840.16	Books	business	0	16
5416.35	Home	paint	0	16
59546.60	Children	toddlers	0	4
61735.34	Children	infants	0	3
62921.16	Men	shirts	0	3
6476.60	Jewelry	semi-precious	0	12
6709.82	Jewelry	birdal	0	11
81504.21	Men	sports-apparel	0	2
83938.68	Shoes	athletic	0	4
85900.84	Men	accessories	0	1
8653.06	Jewelry	rings	0	10
8736.19	Books	home repair	0	15
87570.32	Shoes	mens	0	3
8838.94	Books	parenting	0	14
94138.41	Children	school-uniforms	0	2
98685.13	Shoes	kids	0	2
98777.85	Music	country	0	3
