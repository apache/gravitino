-- Automatically generated by Gravitino Spark SQL test
-- !query
select  *
from (select i_category
            ,i_class
            ,i_brand
            ,i_product_name
            ,d_year
            ,d_qoy
            ,d_moy
            ,s_store_id
            ,sumsales
            ,rank() over (partition by i_category order by sumsales desc) rk
      from (select i_category
                  ,i_class
                  ,i_brand
                  ,i_product_name
                  ,d_year
                  ,d_qoy
                  ,d_moy
                  ,s_store_id
                  ,sum(coalesce(ss_sales_price*ss_quantity,0)) sumsales
            from store_sales
                ,date_dim
                ,store
                ,item
       where  ss_sold_date_sk=d_date_sk
          and ss_item_sk=i_item_sk
          and ss_store_sk = s_store_sk
          and d_month_seq between 1212 and 1212+11
       group by  rollup(i_category, i_class, i_brand, i_product_name, d_year, d_qoy, d_moy,s_store_id))dw1) dw2
where rk <= 100
order by i_category
        ,i_class
        ,i_brand
        ,i_product_name
        ,d_year
        ,d_qoy
        ,d_moy
        ,s_store_id
        ,sumsales
        ,rk
limit 100
-- !query schema
struct<i_category:string,i_class:string,i_brand:string,i_product_name:string,d_year:bigint,d_qoy:bigint,d_moy:bigint,s_store_id:string,sumsales:decimal(28,2),rk:int>
-- !query output
Books	NULL	NULL	NULL	NULL	NULL	NULL	NULL	957901.70	1
Books	arts	NULL	NULL	NULL	NULL	NULL	NULL	47372.33	14
Books	arts	amalgmaxi #x	NULL	NULL	NULL	NULL	NULL	14893.34	46
Books	arts	amalgmaxi #x	NULL	NULL	NULL	NULL	NULL	15513.21	42
Books	arts	amalgmaxi #x	ationcallyationpriought	2001	NULL	NULL	NULL	12472.82	63
Books	arts	amalgmaxi #x	ationcallyationpriought	NULL	NULL	NULL	NULL	12472.82	63
Books	business	NULL	NULL	NULL	NULL	NULL	NULL	48984.76	12
Books	business	importomaxi #x	NULL	NULL	NULL	NULL	NULL	15308.92	44
Books	computers	NULL	NULL	NULL	NULL	NULL	NULL	58034.34	11
Books	computers	exportimaxi #x	NULL	NULL	NULL	NULL	NULL	15428.86	43
Books	computers	exportimaxi #x	NULL	NULL	NULL	NULL	NULL	16046.53	36
Books	cooking	NULL	NULL	NULL	NULL	NULL	NULL	35698.18	17
Books	cooking	amalgunivamalg #x	NULL	NULL	NULL	NULL	NULL	17898.48	33
Books	cooking	amalgunivamalg #x	antioughteseation	2001	1	2	AAAAAAAAKAAAAAAA	11897.52	67
Books	cooking	amalgunivamalg #x	antioughteseation	2001	1	2	NULL	11897.52	67
Books	cooking	amalgunivamalg #x	antioughteseation	2001	1	NULL	NULL	11897.52	67
Books	cooking	amalgunivamalg #x	antioughteseation	2001	NULL	NULL	NULL	11897.52	67
Books	cooking	amalgunivamalg #x	antioughteseation	NULL	NULL	NULL	NULL	11897.52	67
Books	entertainments	NULL	NULL	NULL	NULL	NULL	NULL	43986.10	15
Books	entertainments	edu packmaxi #x	NULL	NULL	NULL	NULL	NULL	26445.57	23
Books	entertainments	edu packmaxi #x	antiablebareseought	2001	4	10	AAAAAAAAKAAAAAAA	13211.38	53
Books	entertainments	edu packmaxi #x	antiablebareseought	2001	4	10	NULL	13211.38	53
Books	entertainments	edu packmaxi #x	antiablebareseought	2001	4	NULL	NULL	13211.38	53
Books	entertainments	edu packmaxi #x	antiablebareseought	2001	NULL	NULL	NULL	13211.38	53
Books	entertainments	edu packmaxi #x	antiablebareseought	NULL	NULL	NULL	NULL	13211.38	53
Books	fiction	NULL	NULL	NULL	NULL	NULL	NULL	64155.75	9
Books	fiction	scholarunivamalg #x	NULL	NULL	NULL	NULL	NULL	20172.57	30
Books	fiction	scholarunivamalg #x	NULL	NULL	NULL	NULL	NULL	24580.25	26
Books	fiction	scholarunivamalg #x	oughtoughtcallycally	2001	1	2	AAAAAAAABAAAAAAA	11148.40	77
Books	fiction	scholarunivamalg #x	oughtoughtcallycally	2001	1	2	NULL	11148.40	77
Books	fiction	scholarunivamalg #x	oughtoughtcallycally	2001	1	NULL	NULL	11148.40	77
Books	fiction	scholarunivamalg #x	oughtoughtcallycally	2001	NULL	NULL	NULL	11148.40	77
Books	fiction	scholarunivamalg #x	oughtoughtcallycally	NULL	NULL	NULL	NULL	11148.40	77
Books	history	NULL	NULL	NULL	NULL	NULL	NULL	64384.02	7
Books	history	scholarmaxi #x	NULL	NULL	NULL	NULL	NULL	12105.40	66
Books	history	scholarmaxi #x	NULL	NULL	NULL	NULL	NULL	12659.27	58
Books	history	scholarmaxi #x	NULL	NULL	NULL	NULL	NULL	13547.52	50
Books	history	scholarmaxi #x	NULL	NULL	NULL	NULL	NULL	15852.90	39
Books	home repair	NULL	NULL	NULL	NULL	NULL	NULL	48406.56	13
Books	home repair	importounivamalg #x	NULL	NULL	NULL	NULL	NULL	13877.16	49
Books	home repair	importounivamalg #x	NULL	NULL	NULL	NULL	NULL	14294.72	48
Books	home repair	importounivamalg #x	NULL	NULL	NULL	NULL	NULL	17027.45	34
Books	home repair	importounivamalg #x	n stationationbarought	2001	1	3	AAAAAAAAHAAAAAAA	10522.00	99
Books	home repair	importounivamalg #x	n stationationbarought	2001	1	3	NULL	10522.00	99
Books	home repair	importounivamalg #x	n stationationbarought	2001	1	NULL	NULL	10522.00	99
Books	home repair	importounivamalg #x	n stationationbarought	2001	NULL	NULL	NULL	10522.00	99
Books	home repair	importounivamalg #x	n stationationbarought	NULL	NULL	NULL	NULL	10522.00	99
Books	mystery	NULL	NULL	NULL	NULL	NULL	NULL	41501.15	16
Books	parenting	NULL	NULL	NULL	NULL	NULL	NULL	64334.43	8
Books	parenting	corpmaxi #x	NULL	NULL	NULL	NULL	NULL	19389.16	31
Books	parenting	corpmaxi #x	NULL	NULL	NULL	NULL	NULL	21108.45	29
Books	reference	NULL	NULL	NULL	NULL	NULL	NULL	91233.08	2
Books	reference	brandmaxi #x	NULL	NULL	NULL	NULL	NULL	14576.25	47
NULL	NULL	NULL	NULL	2001	4	12	AAAAAAAACAAAAAAA	3606.72	5
NULL	NULL	NULL	NULL	2001	4	12	NULL	3606.72	5
NULL	NULL	NULL	NULL	2001	4	NULL	NULL	3606.72	5
NULL	NULL	NULL	NULL	2001	NULL	NULL	NULL	3606.72	5
NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	10783803.09	1
NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	3606.72	5
NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	4528.02	3
NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	4528.02	3
NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	7846.69	2
NULL	NULL	NULL	antiationeinganti	2001	1	1	AAAAAAAAKAAAAAAA	921.30	19
NULL	NULL	NULL	antiationeinganti	2001	1	1	NULL	921.30	19
NULL	NULL	NULL	antiationeinganti	2001	1	NULL	NULL	921.30	19
NULL	NULL	NULL	antiationeinganti	2001	NULL	NULL	NULL	921.30	19
NULL	NULL	NULL	antiationeinganti	NULL	NULL	NULL	NULL	921.30	19
NULL	archery	NULL	NULL	NULL	NULL	NULL	NULL	1108.49	14
NULL	archery	amalgmaxi #x	NULL	NULL	NULL	NULL	NULL	1108.49	14
NULL	archery	amalgmaxi #x	antioughtn stought	2001	3	7	AAAAAAAAIAAAAAAA	701.72	27
NULL	archery	amalgmaxi #x	antioughtn stought	2001	3	7	NULL	701.72	27
NULL	archery	amalgmaxi #x	antioughtn stought	2001	3	8	AAAAAAAAHAAAAAAA	406.77	39
NULL	archery	amalgmaxi #x	antioughtn stought	2001	3	8	NULL	406.77	39
NULL	archery	amalgmaxi #x	antioughtn stought	2001	3	NULL	NULL	1108.49	14
NULL	archery	amalgmaxi #x	antioughtn stought	2001	NULL	NULL	NULL	1108.49	14
NULL	archery	amalgmaxi #x	antioughtn stought	NULL	NULL	NULL	NULL	1108.49	14
NULL	camcorders	NULL	NULL	2001	4	11	AAAAAAAAEAAAAAAA	598.40	32
NULL	camcorders	NULL	NULL	2001	4	11	NULL	598.40	32
NULL	camcorders	NULL	NULL	2001	4	NULL	NULL	598.40	32
NULL	camcorders	NULL	NULL	2001	NULL	NULL	NULL	598.40	32
NULL	camcorders	NULL	NULL	NULL	NULL	NULL	NULL	598.40	32
NULL	camcorders	NULL	NULL	NULL	NULL	NULL	NULL	598.40	32
NULL	camcorders	NULL	NULL	NULL	NULL	NULL	NULL	598.40	32
NULL	pants	NULL	NULL	NULL	NULL	NULL	NULL	179.84	41
NULL	pants	exportiimporto #x	NULL	NULL	NULL	NULL	NULL	179.84	41
NULL	pants	exportiimporto #x	antibarableableought	2001	3	8	AAAAAAAACAAAAAAA	179.84	41
NULL	pants	exportiimporto #x	antibarableableought	2001	3	8	NULL	179.84	41
NULL	pants	exportiimporto #x	antibarableableought	2001	3	NULL	NULL	179.84	41
NULL	pants	exportiimporto #x	antibarableableought	2001	NULL	NULL	NULL	179.84	41
NULL	pants	exportiimporto #x	antibarableableought	NULL	NULL	NULL	NULL	179.84	41
NULL	womens	NULL	NULL	NULL	NULL	NULL	NULL	1431.94	10
NULL	womens	amalgedu pack #x	NULL	2001	3	9	AAAAAAAABAAAAAAA	645.86	29
NULL	womens	amalgedu pack #x	NULL	2001	3	9	NULL	645.86	29
NULL	womens	amalgedu pack #x	NULL	2001	3	NULL	NULL	645.86	29
NULL	womens	amalgedu pack #x	NULL	2001	4	12	AAAAAAAAEAAAAAAA	786.08	24
NULL	womens	amalgedu pack #x	NULL	2001	4	12	NULL	786.08	24
NULL	womens	amalgedu pack #x	NULL	2001	4	NULL	NULL	786.08	24
NULL	womens	amalgedu pack #x	NULL	2001	NULL	NULL	NULL	1431.94	10
NULL	womens	amalgedu pack #x	NULL	NULL	NULL	NULL	NULL	1431.94	10
NULL	womens	amalgedu pack #x	NULL	NULL	NULL	NULL	NULL	1431.94	10
